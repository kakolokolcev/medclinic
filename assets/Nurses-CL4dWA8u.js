import{s as W,c as j,P as w,d as H,r as d,g as I,a as O,h as D,i as q,o as f,j as R,f as h,u as a,k as y,w as b,F as z,l as G,b as T,m as J}from"./index-DKmute59.js";import{E as A,T as K,b as Q,_ as X,c as V,d as Y,a as Z}from"./types-Cza0sOWR.js";const ee=s=>!!s.id,U=[{id:1,name:"Любовь",middlename:"Михайловна",surname:"Скрябина",department:W},{id:2,name:"Маргарита",middlename:"Павловна",surname:"Королева",department:j}],ae=()=>({fetchAll:()=>new Promise(n=>setTimeout(()=>n(U),w)),create:n=>{const l=Math.max(...U.map(({id:m})=>m))+1;return new Promise(m=>setTimeout(()=>m({data:{id:l,...n}}),w))},remove:n=>new Promise(l=>setTimeout(()=>l(!0),w)),update:n=>new Promise(l=>setTimeout(()=>l({data:n}),w))}),L=H("nurse",()=>{const s=ae(),e=d([]),t=d(!1),u=d(!1),n=d(!1);return{isSaving:u,isFetching:t,isRemoving:n,nurses:e,fetchAll:async()=>{t.value=!0,e.value=await s.fetchAll(),t.value=!1},update:async i=>{u.value=!0;const{data:v}=await s.update(i);u.value=!1;const p=e.value.findIndex(({id:g})=>g==i.id);p!==-1&&(e.value[p]={...e.value[p],...v})},remove:async i=>{n.value=!0,await s.remove(i),n.value=!1,e.value=e.value.filter(({id:v})=>v!==i)},create:async i=>{u.value=!0;const{data:v}=await s.create(i);u.value=!1,e.value.push(v)},getStub:()=>({name:"",surname:"",middlename:"",department:null})}});var c=(s=>(s.name="name",s.middlename="middlename",s.surname="surname",s.departmentName="departmentName",s))(c||{});const C=[{id:c.name,header:"Имя",field:"name"},{id:c.middlename,header:"Отчество",field:"middlename"},{id:c.surname,header:"Фамилия",field:"surname"},{id:c.departmentName,header:"Отделение",field:"department.name"}],N=(s,e)=>s.toLowerCase().includes(e.value.toLowerCase()),se=s=>{const e=d(C),t=d(""),u=I(()=>{const n=e.value.map(({id:l})=>l);return s.value.filter(l=>n.includes(c.name)&&N(l.name,t)||n.includes(c.middlename)&&N(l.middlename,t)||n.includes(c.surname)&&N(l.surname,t)||n.includes(c.departmentName)&&N(l.department.name,t))});return{selectedSearchFields:e,searchValue:t,filteredNurses:u}},te=s=>{const e=d(null),t=d(!1);return{editableNurse:e,isOpenModal:t,open:(l,m)=>{m===A.create?e.value=s():l&&(e.value={...l}),t.value=!0},close:()=>{t.value=!1,e.value=null}}},ne={class:"flex flex-col gap-[10px]"},le=O({__name:"Table",setup(s){const e=d(null),t=L(),{nurses:u,isSaving:n,isRemoving:l}=D(t),{create:m,update:F,remove:M,getStub:P}=t,{departments:i}=D(q()),{editableNurse:v,isOpenModal:p,open:g,close:$}=te(P),{searchValue:x,selectedSearchFields:_,filteredNurses:B}=se(u),k=()=>{e.value=null},E=async S=>{await(ee(S)?F(S):m(S)),k(),$()};return(S,r)=>(f(),R("div",ne,[h(a(K),{"selected-search-fields":a(_),"onUpdate:selectedSearchFields":r[0]||(r[0]=o=>y(_)?_.value=o:null),"search-value":a(x),"onUpdate:searchValue":r[1]||(r[1]=o=>y(x)?x.value=o:null),"searched-columns":a(C),"have-selected":!!e.value,"is-remove-loading":a(l),onRemove:r[2]||(r[2]=()=>{e.value&&(a(M)(e.value.id),k())}),onCreate:r[3]||(r[3]=o=>a(g)(e.value,a(A).create)),onEdit:r[4]||(r[4]=o=>a(g)(e.value,a(A).edit))},null,8,["selected-search-fields","search-value","searched-columns","have-selected","is-remove-loading"]),h(a(Q),{selection:e.value,"onUpdate:selection":r[5]||(r[5]=o=>e.value=o),value:a(B),selectionMode:"single",tableStyle:"min-width: 50rem"},{default:b(()=>[(f(!0),R(z,null,G(a(C),o=>(f(),T(a(Z),{key:o.field,field:o.field,header:o.header},null,8,["field","header"]))),128))]),_:1},8,["selection","value"]),a(v)&&a(p)?(f(),T(a(Y),{key:0,visible:a(p),"onUpdate:visible":r[7]||(r[7]=o=>y(p)?p.value=o:null),modal:"",header:"Редактирование",style:{width:"100%",maxWidth:"800px"},class:"m-[20px]"},{default:b(()=>[h(a(V),{"is-loading":a(n)},{default:b(()=>[h(a(X),{person:a(v),departments:a(i),onSave:r[6]||(r[6]=o=>E(o)),onClose:a($)},null,8,["person","departments","onClose"])]),_:1},8,["is-loading"])]),_:1},8,["visible"])):J("",!0)]))}}),ue=O({__name:"Nurses",setup(s){const e=L();return e.fetchAll(),(t,u)=>(f(),T(a(V),{"is-loading":a(e).isFetching},{default:b(()=>[h(a(le))]),_:1},8,["is-loading"]))}});export{ue as default};
