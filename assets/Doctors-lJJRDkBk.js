import{s as U,c as H,P as w,d as I,r as d,a as F,o as S,b as D,w as g,e as C,f,u as a,g as q,h as O,i as G,j as R,k as T,F as J,l as K,n as Q,m as X}from"./index-DKmute59.js";import{s as Y,_ as Z,E as _,T as ee,a as B,b as ae,c as E,d as te}from"./types-Cza0sOWR.js";const se=t=>!!t.id,L=[{id:1,name:"Виктор",middlename:"Иванович",surname:"Павлов",department:U,isSupervisor:!1},{id:2,name:"Андрей",middlename:"Евгеньевич",surname:"Быков",department:H,isSupervisor:!0},{id:3,name:"Иван",middlename:"Натанович",surname:"Купитман",department:U,isSupervisor:!0}],ne=()=>({fetchAll:()=>new Promise(s=>setTimeout(()=>s(L),w)),create:s=>{const r=Math.max(...L.map(({id:c})=>c))+1;return new Promise(c=>setTimeout(()=>c({data:{id:r,...s}}),w))},remove:s=>new Promise(r=>setTimeout(()=>r(!0),w)),update:s=>new Promise(r=>setTimeout(()=>r({data:s}),w))}),j=I("doctor",()=>{const t=ne(),e=d([]),n=d(!1),l=d(!1),s=d(!1);return{isSaving:l,isFetching:n,isRemoving:s,doctors:e,fetchAll:async()=>{n.value=!0,e.value=await t.fetchAll(),n.value=!1},update:async u=>{l.value=!0;const{data:p}=await t.update(u);l.value=!1;const v=e.value.findIndex(({id:h})=>h==u.id);v!==-1&&(e.value[v]={...e.value[v],...p})},remove:async u=>{s.value=!0,await t.remove(u),s.value=!1,e.value=e.value.filter(({id:p})=>p!==u)},create:async u=>{l.value=!0;const{data:p}=await t.create(u);l.value=!1,e.value.push(p)},getStub:()=>({name:"",surname:"",middlename:"",isSupervisor:!1,department:null})}}),le={class:"flex items-center gap-8 mb-8"},re=F({__name:"Form",props:{doctor:{type:Object,default:()=>({})},departments:{type:Array,default:()=>[]}},emits:["save","close"],setup(t){const e=d(!!t.doctor.isSupervisor);return(n,l)=>(S(),D(a(Z),{person:t.doctor,departments:t.departments,onSave:l[1]||(l[1]=s=>n.$emit("save",{...s,isSupervisor:e.value})),onClose:l[2]||(l[2]=s=>n.$emit("close"))},{default:g(()=>[C("div",le,[l[3]||(l[3]=C("label",{for:"department",class:"font-semibold min-[768px]:w-[200px]"}," Заведующий ",-1)),f(a(Y),{modelValue:e.value,"onUpdate:modelValue":l[0]||(l[0]=s=>e.value=s),class:"w-full md:w-56",binary:""},null,8,["modelValue"])])]),_:1},8,["person","departments"]))}});var m=(t=>(t.name="name",t.middlename="middlename",t.surname="surname",t.departmentName="departmentName",t))(m||{});const A=[{id:m.name,header:"Имя",field:"name"},{id:m.middlename,header:"Отчество",field:"middlename"},{id:m.surname,header:"Фамилия",field:"surname"},{id:m.departmentName,header:"Отделение",field:"department.name"}],y=(t,e)=>t.toLowerCase().includes(e.value.toLowerCase()),oe=t=>{const e=d(A),n=d(""),l=q(()=>{const s=e.value.map(({id:r})=>r);return t.value.filter(r=>s.includes(m.name)&&y(r.name,n)||s.includes(m.middlename)&&y(r.middlename,n)||s.includes(m.surname)&&y(r.surname,n)||s.includes(m.departmentName)&&y(r.department.name,n))});return{selectedSearchFields:e,searchValue:n,filteredDoctors:l}},ie=t=>{const e=d(null),n=d(!1);return{editableDoctor:e,isOpenModal:n,open:(r,c)=>{c===_.create?e.value=t():r&&(e.value={...r}),n.value=!0},close:()=>{n.value=!1,e.value=null}}},de={class:"flex flex-col gap-[10px]"},ue=F({__name:"Table",setup(t){const e=d(null),n=j(),{doctors:l,isSaving:s,isRemoving:r}=O(n),{create:c,update:V,remove:M,getStub:N}=n,{departments:u}=O(G()),{editableDoctor:p,isOpenModal:v,open:h,close:k}=ie(N),{searchValue:x,selectedSearchFields:$,filteredDoctors:W}=oe(l),P=()=>{e.value=null},z=async b=>{await(se(b)?V(b):c(b)),P(),k()};return(b,i)=>(S(),R("div",de,[f(a(ee),{"selected-search-fields":a($),"onUpdate:selectedSearchFields":i[0]||(i[0]=o=>T($)?$.value=o:null),"search-value":a(x),"onUpdate:searchValue":i[1]||(i[1]=o=>T(x)?x.value=o:null),"searched-columns":a(A),"have-selected":!!e.value,"is-remove-loading":a(r),onRemove:i[2]||(i[2]=()=>{e.value&&(a(M)(e.value.id),P())}),onCreate:i[3]||(i[3]=o=>a(h)(e.value,a(_).create)),onEdit:i[4]||(i[4]=o=>a(h)(e.value,a(_).edit))},null,8,["selected-search-fields","search-value","searched-columns","have-selected","is-remove-loading"]),f(a(ae),{selection:e.value,"onUpdate:selection":i[5]||(i[5]=o=>e.value=o),value:a(W),selectionMode:"single",tableStyle:"min-width: 50rem"},{default:g(()=>[(S(!0),R(J,null,K(a(A),o=>(S(),D(a(B),{key:o.field,field:o.field,header:o.header},null,8,["field","header"]))),128)),f(a(B),{field:"isSupervisor",header:"Заведующий"},{body:g(({data:{isSupervisor:o}})=>[C("i",{class:Q(`pi ${o?"pi-check":"pi-times"}`)},null,2)]),_:1})]),_:1},8,["selection","value"]),a(p)&&a(v)?(S(),D(a(te),{key:0,visible:a(v),"onUpdate:visible":i[6]||(i[6]=o=>T(v)?v.value=o:null),modal:"",header:"Редактирование",style:{width:"100%",maxWidth:"800px"},class:"m-[20px]"},{default:g(()=>[f(a(E),{"is-loading":a(s)},{default:g(()=>[f(a(re),{doctor:a(p),departments:a(u),onSave:z,onClose:a(k)},null,8,["doctor","departments","onClose"])]),_:1},8,["is-loading"])]),_:1},8,["visible"])):X("",!0)]))}}),pe=F({__name:"Doctors",setup(t){const e=j();return e.fetchAll(),(n,l)=>(S(),D(a(E),{"is-loading":a(e).isFetching},{default:g(()=>[f(a(ue))]),_:1},8,["is-loading"]))}});export{pe as default};
